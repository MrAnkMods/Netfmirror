<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>NMix â€” Details</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body{margin:0;background:#000;color:#fff;font-family:Arial,Helvetica,sans-serif;line-height:1.4}
  .wrap{padding-bottom:60px}
  
  /* ---- Header Poster ---- */
  .banner{
    position:relative;
    width:100%;
    height:220px;
    overflow:hidden;
  }
  .banner img{
    width:100%;
    height:100%;
    object-fit:cover;
    filter:brightness(0.65);
  }
  .overlay{
    position:absolute;
    bottom:20px;
    left:20px;
  }
  .title{
    font-size:24px;
    font-weight:bold;
    margin-bottom:6px;
  }
  .meta{
    font-size:14px;
    color:#ccc;
    margin-bottom:14px;
  }

  /* ---- Buttons ---- */
  .btns{
    display:flex;
    gap:10px;
  }
  .btn{
    border:none;
    border-radius:6px;
    font-weight:bold;
    font-size:15px;
    cursor:pointer;
  }
  .btn.play{
    background:#fff;
    color:#000;
    padding:10px 22px;
  }
  .btn.download{
    background:transparent;
    border:1px solid #444;
    color:#fff;
    padding:10px 22px;
  }

  /* ---- Description ---- */
  .desc{
    padding:16px 20px;
    color:#bbb;
    font-size:15px;
  }

  /* ---- Episodes ---- */
  .episodes{
    padding:10px 20px;
  }
  .episodes h3{
    margin:10px 0;
    font-size:18px;
  }
  .ep{
    display:flex;
    align-items:center;
    justify-content:space-between;
    background:#111;
    border-radius:8px;
    padding:10px;
    margin-bottom:8px;
  }
  .ep .left{
    display:flex;
    align-items:center;
    gap:10px;
  }
  .ep img{
    width:100px;
    height:60px;
    object-fit:cover;
    border-radius:6px;
  }
  .ep .info{
    font-size:14px;
  }
  .ep button{
    border:none;
    background:transparent;
    color:#fff;
    font-size:18px;
    cursor:pointer;
  }

  /* ---- Toast ---- */
  #toast {
    visibility: hidden;
    min-width: 220px;
    background-color: #e50914;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 10px;
    position: fixed;
    z-index: 1000;
    left: 50%;
    bottom: 30px;
    transform: translateX(-50%);
    font-weight: bold;
  }
  #toast.show {
    visibility: visible;
    animation: fadein 0.4s, fadeout 0.4s 2.5s;
  }
  @keyframes fadein {
    from {bottom: 0; opacity: 0;}
    to {bottom: 30px; opacity: 1;}
  }
  @keyframes fadeout {
    from {bottom: 30px; opacity: 1;}
    to {bottom: 0; opacity: 0;}
  }
</style>
</head>
<body>

<div class="wrap" id="mainArea"></div>
<div id="toast">Not available right now</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC4S_DbJCwOyg2akeBmInBYcuBrPvvVrj8",
  authDomain: "ankmods0.firebaseapp.com",
  databaseURL: "https://ankmods0-default-rtdb.firebaseio.com",
  projectId: "ankmods0",
  storageBucket: "ankmods0.firebasestorage.app",
  messagingSenderId: "760044029682",
  appId: "1:760044029682:web:a5c234e03542c309ce726b"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const params = new URLSearchParams(location.search);
const type = params.get("type") || "movie";
const id = params.get("id");

const main = document.getElementById("mainArea");

function showToast(msg){
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),3000);
}

if(!id){ main.innerHTML = "<p style='padding:20px'>No item specified.</p>"; }
else {
  const node = type === "series" ? "series" : "movies";
  onValue(ref(db, node + "/" + id), snap=>{
    const d = snap.val();
    if(!d){ main.innerHTML = "<p style='padding:20px'>Item not found.</p>"; return; }

    // ðŸŽ¬ Common Banner
    let html = `
      <div class="banner">
        <img src="${d.poster || 'assets/banner1.jpg'}">
        <div class="overlay">
          <div class="title">${d.title || ''}</div>
          <div class="meta">${d.year || ''} â€¢ ${d.category || d.section || ''}</div>
          <div class="btns">
            <button class="btn play" id="playBtn">â–¶ Play</button>
            <button class="btn download" id="downloadBtn">â¬‡ Download</button>
          </div>
        </div>
      </div>
      <div class="desc">${d.description || ''}</div>
    `;

    // ðŸ“º Series Episodes
    if(type === "series" && d.seasons?.length){
      html += `<div class="episodes"><h3>Episodes</h3>`;
      d.seasons.forEach((s, si)=>{
        s.episodes?.forEach((ep, ei)=>{
          html += `
            <div class="ep">
              <div class="left">
                <img src="${ep.thumb || d.poster || 'assets/banner1.jpg'}">
                <div class="info"><b>${ep.epTitle || ('Episode '+(ei+1))}</b><br>${ep.duration || ''}</div>
              </div>
              <button class="epPlay" data-video="${encodeURIComponent(ep.video || '')}">â–¶</button>
            </div>
          `;
        });
      });
      html += `</div>`;
    }

    main.innerHTML = html;

    // â–¶ Play Button
    const playBtn = document.getElementById("playBtn");
    playBtn.onclick = ()=>{
      let videoUrl = "";
      let titleTxt = d.title || "";
      if(type === "movie" && d.video){
        videoUrl = d.video;
      } else if(type === "series" && d.seasons?.length){
        const firstEp = d.seasons[0].episodes?.[0];
        if(firstEp?.video){
          videoUrl = firstEp.video;
          titleTxt += " â€” " + (firstEp.epTitle || "Episode 1");
        }
      }
      if(!videoUrl){ showToast("No video available"); return; }
      const url = `player.html?src=${encodeURIComponent(videoUrl)}&title=${encodeURIComponent(titleTxt)}&poster=${encodeURIComponent(d.poster||'')}`;
      window.location = url;
    };

    // â¬‡ Download
    document.getElementById("downloadBtn").onclick = ()=> showToast("Not available right now");

    // â–¶ Episode Play Buttons
    document.querySelectorAll(".epPlay").forEach(b=>{
      b.onclick = (ev)=>{
        let v = decodeURIComponent(ev.currentTarget.dataset.video||'');
        if(!v){ showToast("No video found"); return; }
        const playerUrl = `player.html?src=${encodeURIComponent(v)}&title=${encodeURIComponent(d.title || '')}&poster=${encodeURIComponent(d.poster||'')}`;
        window.location = playerUrl;
      };
    });
  });
}
</script>
</body>
</html>