<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NMix — Details</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>
<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#000;color:#fff;}
.banner{position:relative;width:100%;height:55vh;overflow:hidden;}
.banner img{width:100%;height:100%;object-fit:cover;filter:brightness(0.6);}
.content{padding:20px;}
h1{font-size:28px;margin:10px 0;color:#fff;}
p{font-size:15px;color:#ccc;line-height:1.5;}
button{padding:10px 20px;border:none;border-radius:6px;margin:6px 8px;cursor:pointer;font-weight:bold;}
.play{background:#e50914;color:#fff;}
.download{background:#222;color:#fff;}
.back{position:absolute;top:15px;left:15px;background:rgba(0,0,0,0.5);border:none;padding:10px 14px;border-radius:50%;cursor:pointer;}
.back svg{width:22px;height:22px;stroke:#fff;}
.more-section{padding:20px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:12px;}
.grid img{width:100%;border-radius:6px;cursor:pointer;object-fit:cover;height:180px;}
select{background:#111;color:#fff;padding:6px 10px;border:none;border-radius:4px;}
.episodes{margin-top:10px;}
.ep-item{background:#111;padding:8px 10px;border-radius:6px;margin:5px 0;cursor:pointer;}
.ep-item:hover{background:#222;}
</style>
</head>
<body>

<div class="banner">
  <button class="back" onclick="history.back()">
    <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </button>
  <img id="banner" src="">
</div>

<div class="content">
  <h1 id="title">Loading...</h1>
  <p id="desc"></p>
  <div id="movieActions">
    <button class="play" id="playBtn">▶ Play</button>
    <button class="download" id="downloadBtn">⬇ Download</button>
  </div>

  <div id="seriesActions" style="display:none;">
    <select id="seasonSelect"></select>
    <div class="episodes" id="episodes"></div>
  </div>
</div>

<div class="more-section">
  <h2>More Like This</h2>
  <div class="grid" id="moreGrid"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig={
  apiKey:"AIzaSyC4S_DbJCwOyg2akeBmInBYcuBrPvvVrj8",
  authDomain:"ankmods0.firebaseapp.com",
  databaseURL:"https://ankmods0-default-rtdb.firebaseio.com",
  projectId:"ankmods0",
  storageBucket:"ankmods0.firebasestorage.app",
  messagingSenderId:"760044029682",
  appId:"1:760044029682:web:a5c234e03542c309ce726b"
};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

const params=new URLSearchParams(location.search);
const id=params.get("id");
const type=params.get("type"); // 'movie' or 'series'

const titleEl=document.getElementById("title");
const descEl=document.getElementById("desc");
const bannerEl=document.getElementById("banner");
const playBtn=document.getElementById("playBtn");
const downloadBtn=document.getElementById("downloadBtn");
const movieActions=document.getElementById("movieActions");
const seriesActions=document.getElementById("seriesActions");
const seasonSelect=document.getElementById("seasonSelect");
const episodesDiv=document.getElementById("episodes");
const moreGrid=document.getElementById("moreGrid");

let contentData=null;

if(type==="movie"){
  onValue(ref(db,"movies/"+id),snap=>{
    const d=snap.val();if(!d)return;
    contentData=d;
    titleEl.textContent=d.title;
    descEl.textContent=d.desc||"No description.";
    bannerEl.src=d.banner||d.poster;
    playBtn.onclick=()=>window.location=`player.html?src=${encodeURIComponent(d.video)}&title=${encodeURIComponent(d.title)}`;
    downloadBtn.onclick=()=>window.open(d.video,"_blank");
    loadMore(d.section,id);
  });
}else{
  onValue(ref(db,"series/"+id),snap=>{
    const d=snap.val();if(!d)return;
    contentData=d;
    titleEl.textContent=d.title;
    descEl.textContent=d.desc||"No description.";
    bannerEl.src=d.banner||d.poster;
    movieActions.style.display="none";
    seriesActions.style.display="block";
    seasonSelect.innerHTML="";
    d.seasons.forEach((s,i)=>{
      const opt=document.createElement("option");
      opt.value=i;opt.textContent=s.season;
      seasonSelect.appendChild(opt);
    });
    seasonSelect.onchange=()=>loadEpisodes(seasonSelect.value);
    loadEpisodes(0);
    loadMore(d.section,id);
  });
}

function loadEpisodes(i){
  const s=contentData.seasons[i];
  episodesDiv.innerHTML="";
  s.episodes.forEach(ep=>{
    const div=document.createElement("div");
    div.className="ep-item";
    div.textContent=ep.title;
    div.onclick=()=>window.location=`player.html?src=${encodeURIComponent(ep.video)}&title=${encodeURIComponent(ep.title)}`;
    episodesDiv.appendChild(div);
  });
}

function loadMore(category,skipId){
  onValue(ref(db,"movies"),snap=>{
    moreGrid.innerHTML="";
    snap.forEach(s=>{
      const d=s.val(),id=s.key;
      if(id===skipId)return;
      if(d.section===category){
        const img=document.createElement("img");
        img.src=d.poster;
        img.onclick=()=>window.location=`details.html?type=movie&id=${id}`;
        moreGrid.appendChild(img);
      }
    });
  });
}
</script>
</body>
</html>